# Repository Guidelines

refer to ./ai/project_overview.md for full scope of this project

## Library Documentation

- Use Context7 MCP constantly to look up fresh documentation for any task you're looking to complete, especially tasks that rely on using libraries or gems

### Project Dependencies & context7 links

- Feedjirra - https://context7.com/feedjira/feedjira

## Project Structure & Module Organization

The engine follows the Rails mountable layout generated by `rails plugin new feed_monitor --mountable`. Runtime code lives under `app/` (controllers, jobs, views) and is namespaced as `FeedMonitor`. Long-lived services, adapters, and instrumentation helpers belong in `lib/feed_monitor/`. Generator templates and install scripts reside in `lib/generators/feed_monitor/`. Tests sit in `test/`, with fixtures under `test/fixtures/feeds/`, and the dummy host app in `test/dummy/` for integration coverage. Keep shared UI assets under `app/assets/` and engine configuration in `config/initializers/`.

## Build, Test, and Development Commands

Run `bin/setup` to install gems, prepare the dummy database, and compile Tailwind. Use `bin/rails test` (or `bundle exec rake test`) for the full MiniTest suite, including system tests through the dummy app. During feature work, `bin/dev` starts the dummy app with Solid Queue workers and Tailwind watcher. Trigger a feed ingest locally with `bin/rails runner 'FeedMonitor::FetchFeeds.call'` once the fetcher service lands.

## Coding Style & Naming Conventions

Use two-space indentation and Ruby 3.3 syntax. Keep engine classes under the `FeedMonitor::` namespace; new modules should mirror their directory, e.g., `lib/feed_monitor/fetching/pipeline.rb`. Favor service objects ending in `Service`, jobs ending in `Job`, and background channels ending in `Channel`. Rails defaults handle formatting, but run `bundle exec rubocop` (configured via `.rubocop.yml`) before opening a PR. For views, stick with ERB and Tailwind utility classes.

## Testing Guidelines

MiniTest drives coverage (`test/models`, `test/controllers`, `test/system`). Name files with `_test.rb` and wrap suites in `module FeedMonitor`. Add VCR cassettes under `test/vcr_cassettes/` when touching HTTP clients, and record new fixtures with descriptive names like `source_fetch_success.yml`. Target >90% coverage for new services and include regression tests for bug fixes. Use `bin/rails test test/system` before changing UI flows.

## Commit & Pull Request Guidelines

Adopt imperative commit messages in the format `scope: action`, e.g., `sources: enforce URL normalization`. Group unrelated work into separate commits. PRs should describe context, summarise the slice delivered, list validation steps (`bin/rails test`, manual fetch run), and reference roadmap items from `.ai/tasks.md`. Include screenshots or console output when altering UI or background jobs. Request at least one review and ensure CI completes before merge.

## Security & Configuration Tips

Store secrets (API keys, webhook tokens) in `config/credentials/` and never commit plain-text values. When adding HTTP endpoints or webhooks, default to Solid Queue middleware for retries and respect the allowlist in `config/feed_monitor.yml`. Document new environment variables in `config/application.yml.sample` and call out any migrations that impact host apps.
