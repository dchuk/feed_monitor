<div class="space-y-6">
  <div class="flex flex-wrap items-start justify-between gap-4">
    <div>
      <h1 class="text-3xl font-semibold text-slate-900">Scrape Log</h1>
      <p class="mt-1 text-sm text-slate-500">
        Started <%= @log.started_at&.strftime("%b %d, %Y %H:%M:%S %Z") || "Unknown" %> ·
        <%= @log.success? ? "Success" : "Failure" %>
      </p>
    </div>
    <div class="flex gap-3">
      <%= link_to "Back to Logs", source_monitor.logs_path(log_type: "scrape"), class: "inline-flex items-center rounded-md border border-slate-300 px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50" %>
      <%= link_to "View Item", source_monitor.item_path(@log.item), class: "inline-flex items-center rounded-md bg-slate-800 px-3 py-2 text-sm font-medium text-white hover:bg-slate-700" %>
    </div>
  </div>

  <div class="grid gap-6 lg:grid-cols-2">
    <div class="rounded-lg border border-slate-200 bg-white shadow-sm">
      <div class="border-b border-slate-200 px-5 py-4">
        <h2 class="text-lg font-medium">Summary</h2>
      </div>
      <dl class="divide-y divide-slate-100">
        <% summary = {
             "Item" => link_to(@log.item.title.presence || "(untitled)", source_monitor.item_path(@log.item)),
             "Source" => link_to(@log.source.name, source_monitor.source_path(@log.source)),
             "Scraper Adapter" => @log.scraper_adapter || "—",
             "HTTP Status" => @log.http_status || "—",
             "Success" => @log.success? ? "Yes" : "No",
             "Duration (ms)" => @log.duration_ms || "—",
             "Content Length" => @log.content_length || "—",
             "Started At" => @log.started_at&.strftime("%b %d, %Y %H:%M:%S %Z") || "—",
             "Completed At" => @log.completed_at&.strftime("%b %d, %Y %H:%M:%S %Z") || "—"
           } %>
        <% summary.each do |label, value| %>
          <div class="flex items-center justify-between px-5 py-3">
            <dt class="text-sm font-medium text-slate-600"><%= label %></dt>
            <dd class="text-sm text-slate-900 text-right"><%= value %></dd>
          </div>
        <% end %>
      </dl>
    </div>

    <div class="space-y-6">
      <div class="rounded-lg border border-slate-200 bg-white shadow-sm">
        <div class="border-b border-slate-200 px-5 py-4">
          <h2 class="text-lg font-medium">Error Details</h2>
        </div>
        <div class="px-5 py-4 text-sm text-slate-700">
          <% if @log.success? %>
            <p class="text-slate-500">No errors recorded.</p>
          <% else %>
            <% if @log.error_class.present? %>
              <p class="font-medium text-rose-600"><%= @log.error_class %></p>
            <% end %>
            <p class="mt-2 whitespace-pre-wrap break-words text-xs text-slate-600"><%= @log.error_message.presence || "No error message captured." %></p>
          <% end %>
        </div>
      </div>

      <div class="rounded-lg border border-slate-200 bg-white shadow-sm">
        <div class="border-b border-slate-200 px-5 py-4">
          <h2 class="text-lg font-medium">Metadata</h2>
        </div>
        <div class="px-5 py-4 text-sm text-slate-700">
          <% if @log.metadata.present? %>
            <pre class="whitespace-pre-wrap break-words text-xs text-slate-600"><%= JSON.pretty_generate(@log.metadata) %></pre>
          <% else %>
            <p class="text-slate-500">No metadata recorded.</p>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
